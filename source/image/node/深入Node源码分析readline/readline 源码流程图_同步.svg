<?xml version="1.0" standalone="no"?>
<svg style="background: #FFFFFF;" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1615px" height="1291px" viewBox="-0.5 -0.5 1575 1231"><defs><style>* {margin: 0px; padding: 0px;}</style></defs><g><path d="M 713 80 L 713 151.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 713 158.88 L 710.67 151.88 L 715.33 151.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="638" y="0" width="150" height="80" fill="#e6e6e6" stroke="#999999" pointer-events="none"/><g transform="translate(641.5,11.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="134" height="54"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 135px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span>readline.createInterface({<br/>  input: process.stdin, <br/> output: process.stdout<br/>})</span></div></div></foreignObject></g><path d="M 713 220 L 713 291.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 713 298.88 L 710.67 291.88 L 715.33 291.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="578" y="160" width="270" height="60" fill="#e6e6e6" stroke="#999999" pointer-events="none"/><g transform="translate(581.5,182.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="257" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 258px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">new Interface(input, output, completer, terminal);</span></div></div></foreignObject></g><path d="M 713 350 L 713 501.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 713 508.88 L 710.67 501.88 L 715.33 501.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 808 325 L 1040.88 325" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1047.88 325 L 1040.88 327.33 L 1040.88 322.67 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="618" y="300" width="190" height="50" fill="#e6e6e6" stroke="#999999" pointer-events="none"/><g transform="translate(621.5,317.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="172" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 173px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">emitKeypressEvents(input, this);</span></div></div></foreignObject></g><path d="M 1129 351 L 1128.92 601.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1128.92 608.88 L 1126.59 601.88 L 1131.26 601.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1339 325 Q 1339 325 1425.88 325" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1432.88 325 L 1425.88 327.33 L 1425.88 322.67 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="1049" y="300" width="290" height="50" fill="#ffffcc" stroke="#999999" pointer-events="none"/><g transform="translate(1052.5,310.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="270" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 271px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">stream[ESCAPE_DECODER] = emitKeys(stream);<br/>执行 emitKeys generate 函数<br/></span></div></div></foreignObject></g><path d="M 1479 350 Q 1479 350 1479 391.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1479 398.88 L 1476.67 391.88 L 1481.33 391.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="1434" y="300" width="90" height="50" fill="#cccccc" stroke="#999999" pointer-events="none"/><g transform="translate(1437.5,317.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="70" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 71px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">let ch = yield;</span><span style="white-space: nowrap"><br/></span></div></div></foreignObject></g><path d="M 1479 450 Q 1479 450 1479 501.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1479 508.88 L 1476.67 501.88 L 1481.33 501.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="1409" y="400" width="140" height="50" fill="#ffffcc" stroke="#999999" pointer-events="none"/><g transform="translate(1412.5,410.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="121" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 122px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">对字符进行一系列校验<br/>如: 空格，esc，回车等<br/></span></div></div></foreignObject></g><path d="M 1418 510 L 1418 470 L 780 470 L 780 497.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 780 504.88 L 777.67 497.88 L 782.33 497.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="1384" y="510" width="190" height="50" fill="#ccffff" stroke="#999999" pointer-events="none"/><g transform="translate(1387.5,520.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="165" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 166px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">stream.emit('keypress', s, key);<br/></span><span style="white-space: nowrap">触发 keypress 事件<br/></span></div></div></foreignObject></g><path d="M 1127 659.75 L 1128.43 741.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1128.55 748.88 L 1126.09 741.92 L 1130.76 741.84 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="1049" y="610" width="240" height="50" fill="#ccffcc" stroke="#999999" pointer-events="none"/><g transform="translate(1052.5,620.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="221" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 222px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">stream.on('newListener', onNewListener);<br/></span><span style="white-space: nowrap">注册 newListener 监听<br/></span></div></div></foreignObject></g><path d="M 1209 775 L 1280.88 775" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1287.88 775 L 1280.88 777.33 L 1280.88 772.67 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="1049" y="750" width="160" height="50" fill="#ccffcc" stroke="#999999" pointer-events="none"/><g transform="translate(1052.5,753.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="138" height="40"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 139px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">stream.on('data', onData);</span><span style="white-space: nowrap"><br/>注册 onData 事件且<br/>移除 newListener 事件</span><span style="white-space: nowrap"><br/></span></div></div></foreignObject></g><path d="M 1325.92 751 L 1325.1 359.12" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1325.08 352.12 L 1327.43 359.11 L 1322.76 359.12 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(1276.5,680.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="102" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><span style="background-color: rgb(255 , 255 , 255)">回调 generate 函数</span></div></div></foreignObject></g><rect x="1289" y="750" width="260" height="50" fill="#ccffcc" stroke="#999999" pointer-events="none"/><g transform="translate(1292.5,767.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="246" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 247px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">stream[ESCAPE_DECODER].next(character);</span><span style="white-space: nowrap"><br/></span></div></div></foreignObject></g><path d="M 713 560 L 713 626.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 713 633.88 L 710.67 626.88 L 715.33 626.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 808 536 L 1074 536 L 1074 601.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1074 608.88 L 1071.67 601.88 L 1076.33 601.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(908.5,529.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="119" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">广播 newListener 事件</div></div></foreignObject></g><path d="M 618 536 L 568 536 L 516.12 536" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 509.12 536 L 516.12 533.67 L 516.12 538.33 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(543.5,529.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="48" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">写入字符</div></div></foreignObject></g><rect x="618" y="510" width="190" height="50" fill="#ccffcc" stroke="#999999" pointer-events="none"/><g transform="translate(621.5,520.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="171" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 172px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">input.on('keypress', onkeypress)<br/>注册 keypress 监听<br/></span></div></div></foreignObject></g><path d="M 408 560 L 408 626.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 408 633.88 L 405.67 626.88 L 410.33 626.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(383.5,591.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="48" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 11px; font-family: Helvetica; color: rgb(77, 77, 77); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">常规字符</div></div></foreignObject></g><path d="M 308 535 L 208.12 535" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 201.12 535 L 208.12 532.67 L 208.12 537.33 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(232.5,528.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="43" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;">enter 键</div></div></foreignObject></g><rect x="308" y="510" width="200" height="50" fill="#9999ff" stroke="#999999" pointer-events="none"/><g transform="translate(311.5,520.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="180" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 181px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">self._ttyWrite(s, key);<br/></span><span style="white-space: nowrap">写入数据，对数据进行一系列校验<br/></span></div></div></foreignObject></g><path d="M 100 560 L 100 626.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 100 633.88 L 97.67 626.88 L 102.33 626.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="0" y="510" width="200" height="50" fill="#9999ff" stroke="#999999" pointer-events="none"/><g transform="translate(71.5,520.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="56" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 56px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">this._line()<br/></span><span style="white-space: nowrap">准备关闭<br/></span></div></div></foreignObject></g><path d="M 100 685 L 100 746.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 100 753.88 L 97.67 746.88 L 102.33 746.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="0" y="635" width="200" height="50" fill="#9999ff" stroke="#999999" pointer-events="none"/><g transform="translate(60.5,652.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="78" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 80px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="text-align: left ; white-space: nowrap">this.clearLine()</span><span style="white-space: nowrap"><br/></span></div></div></foreignObject></g><path d="M 100 805 L 100 841.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 100 848.88 L 97.67 841.88 L 102.33 841.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="0" y="755" width="200" height="50" fill="#9999ff" stroke="#999999" pointer-events="none"/><g transform="translate(53.5,772.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="92" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 92px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="text-align: left ; white-space: nowrap">this._onLine(line)</span><span style="white-space: nowrap"><br/></span></div></div></foreignObject></g><path d="M 408 685 L 408 746.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 408 753.88 L 405.67 746.88 L 410.33 746.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="308" y="635" width="200" height="50" fill="#9999ff" stroke="#999999" pointer-events="none"/><g transform="translate(311.5,652.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="183" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 184px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">this._insertString(lines[i]) 准备写入</span><span style="white-space: nowrap"><br/></span></div></div></foreignObject></g><path d="M 408 810 L 408 851.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 408 858.88 L 405.67 851.88 L 410.33 851.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="308" y="755" width="200" height="50" fill="#9999ff" stroke="#999999" pointer-events="none"/><g transform="translate(311.5,772.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="120" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 121px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">this._writeToOutput(c);</span><span style="white-space: nowrap"><br/></span></div></div></foreignObject></g><path d="M 408 910 L 408 1026 L 528 1026 L 609.88 1026" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 616.88 1026 L 609.88 1028.33 L 609.88 1023.67 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(467.5,1021.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="63" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;"><span style="font-size: 12px ; text-align: left ; white-space: pre">命令行回显 </span></div></div></foreignObject></g><rect x="308" y="860" width="200" height="50" fill="#9999ff" stroke="#999999" pointer-events="none"/><g transform="translate(311.5,869.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="189" height="28"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 190px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span class="token keyword" style="box-sizing: border-box ; font-family: , , &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , monospace ; font-size: 14px ; white-space: pre">this</span><span class="token punctuation" style="box-sizing: border-box ; font-size: 14px ; white-space: pre">.</span><span style="box-sizing: border-box ; font-size: 14px ; white-space: pre">output</span><span class="token punctuation" style="box-sizing: border-box ; font-size: 14px ; white-space: pre">.</span><span class="token function" style="box-sizing: border-box ; font-family: , , &quot;consolas&quot; , &quot;liberation mono&quot; , &quot;menlo&quot; , monospace ; font-size: 14px ; white-space: pre">write</span><span class="token punctuation" style="box-sizing: border-box ; font-size: 14px ; white-space: pre">(</span><span style="box-sizing: border-box ; font-size: 14px ; white-space: pre">stringToWrite</span><span class="token punctuation" style="box-sizing: border-box"><span style="font-size: 14px ; white-space: pre">)</span><br/></span><span style="white-space: nowrap">调用输出流的 write 进行写入<br/></span></div></div></foreignObject></g><rect x="618" y="1002.5" width="190" height="50" fill="#cccccc" stroke="#999999" stroke-dasharray="3 3" pointer-events="none"/><g transform="translate(676.5,1020.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="72" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 73px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">等待用户输入</span></div></div></foreignObject></g><path d="M 713 685 L 713 746.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 713 753.88 L 710.67 746.88 L 715.33 746.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="618" y="635" width="190" height="50" fill="#ccffcc" stroke="#999999" pointer-events="none"/><g transform="translate(621.5,645.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="143" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 144px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">input.on('end', ontermend);<br/></span><span style="white-space: nowrap">注册 end 监听<br/></span></div></div></foreignObject></g><path d="M 712 912 L 712 956 L 714 956 L 714 994.38" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 714 1001.38 L 711.67 994.38 L 716.33 994.38 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(677.5,949.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="72" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;background-color:#ffffff;"><span style="color: rgb(77 , 77 , 77) ; background-color: rgb(248 , 249 , 250)">同步流程结束</span></div></div></foreignObject></g><path d="M 713 805 L 713 851.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 713 858.88 L 710.67 851.88 L 715.33 851.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="618" y="755" width="190" height="50" fill="#e6ffcc" stroke="#999999" pointer-events="none"/><g transform="translate(621.5,765.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="131" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 132px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">this._setRawMode(true);<br/>设置逐字监听</span><span style="white-space: nowrap"><br/></span></div></div></foreignObject></g><path d="M 808 885 L 879.88 885" fill="none" stroke="#999999" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 886.88 885 L 879.88 887.33 L 879.88 882.67 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="618" y="860" width="190" height="50" fill="#e6ffcc" stroke="#999999" pointer-events="none"/><g transform="translate(621.5,863.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="138" height="40"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 139px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">self.once('close', <br/>onSelfCloseWithTerminal)<br/></span><span style="white-space: nowrap">注册 close 监听<br/></span></div></div></foreignObject></g><rect x="888" y="860" width="170" height="50" fill="#e6ffcc" stroke="#999999" pointer-events="none"/><g transform="translate(891.5,877.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="151" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 152px; white-space: nowrap; overflow-wrap: normal; text-align: left;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="white-space: nowrap">移除 keypress 及其所有监听<br/></span></div></div></foreignObject></g><path d="M 1286 1000 Q 1286 900 1208 900 Q 1130 900 1130 808.12" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1130 801.12 L 1132.33 808.12 L 1127.67 808.12 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1024 1000 L 1164 1000 L 1164 1050 L 1024 1050 L 1024 1000 Z" fill="#ffb366" stroke="none" pointer-events="none"/><path d="M 1029.83 1004.17 L 1029.83 1045.83 L 1029.83 1045.83 L 1158.17 1045.83 L 1158.17 1004.17 L 1029.83 1004.17" fill="#ffb366" stroke="none" pointer-events="none"/><path d="M 1024 1000 L 1164 1000 L 1164 1050 L 1024 1050 L 1024 1000 Z" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="1092.5" y="1027.5">addChunk()</text></g><path d="M 1204 1000 L 1364 1000 L 1364 1050 L 1204 1050 L 1204 1000 Z" fill="#ffb366" stroke="none" pointer-events="none"/><path d="M 1210.67 1004.17 L 1210.67 1045.83 L 1210.67 1045.83 L 1357.33 1045.83 L 1357.33 1004.17 L 1210.67 1004.17" fill="#ffb366" stroke="none" pointer-events="none"/><path d="M 1204 1000 L 1364 1000 L 1364 1050 L 1204 1050 L 1204 1000 Z" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="1282.5" y="1027.5">stream.emit('data', chunk);</text></g><path d="M 1164 1025 L 1195.88 1025" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 1202.88 1025 L 1195.88 1027.33 L 1195.88 1022.67 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(1178.5,973.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="91" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; white-space: nowrap; font-weight: bold; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;">流发出 data 事件</div></div></foreignObject></g><path d="M 100 920 L 100 966.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 100 973.88 L 97.67 966.88 L 102.33 966.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 100 850 L 175 885 L 100 920 L 25 885 Z" fill="#9999ff" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><g fill="#000000" font-family="Helvetica" text-anchor="middle" font-size="12px"><text x="98.5" y="873.5">开发者是否添加了 </text><text x="98.5" y="887.5">questionCallback</text><text x="98.5" y="901.5">回调</text></g><path d="M 100 1025 L 100 1067.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 100 1074.88 L 97.67 1067.88 L 102.33 1067.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="0" y="975" width="200" height="50" fill="#9999ff" stroke="#999999" pointer-events="none"/><g transform="translate(9.5,985.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="180" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 181px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="text-align: left ; white-space: nowrap">cb(line)<br/></span><span style="white-space: nowrap">调用开发者写的回调，传入字符串<br/></span></div></div></foreignObject></g><path d="M 100 1126 L 100 1171.88" fill="none" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><path d="M 100 1178.88 L 97.67 1171.88 L 102.33 1171.88 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><rect x="0" y="1076" width="200" height="50" fill="#9ac7bf" stroke="#999999" pointer-events="none"/><g transform="translate(4.5,1086.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="190" height="26"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 192px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="text-align: left ; white-space: nowrap">rl.close()<br/></span><span style="white-space: nowrap">开发者处理完逻辑后手动调用 close <br/></span></div></div></foreignObject></g><path d="M 200 1206 L 558 1206 L 558 884 L 609.88 884" fill="none" stroke="#999999" stroke-miterlimit="10" stroke-dasharray="3 3" pointer-events="none"/><path d="M 616.88 884 L 609.88 886.33 L 609.88 881.67 Z" fill="#999999" stroke="#999999" stroke-miterlimit="10" pointer-events="none"/><g transform="translate(367.5,1199.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="83" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(51, 51, 51); line-height: 1.2; vertical-align: top; white-space: nowrap; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;"><span style="color: rgb(0 , 0 , 0) ; background-color: rgb(255 , 255 , 255)">广播 close 事件</span></div></div></foreignObject></g><rect x="0" y="1180" width="200" height="50" fill="#9999ff" stroke="#999999" pointer-events="none"/><g transform="translate(56.5,1197.5)"><foreignObject style="overflow:visible;" pointer-events="all" width="86" height="12"><div xmlns="http://www.w3.org/1999/xhtml" style="display: inline-block; font-size: 12px; font-family: Helvetica; color: rgb(0, 0, 0); line-height: 1.2; vertical-align: top; width: 86px; white-space: nowrap; overflow-wrap: normal; text-align: center;"><div xmlns="http://www.w3.org/1999/xhtml" style="display:inline-block;text-align:inherit;text-decoration:inherit;white-space:normal;"><span style="text-align: left ; white-space: nowrap">this.emit('close')</span><span style="white-space: nowrap"><br/></span></div></div></foreignObject></g></g></svg>